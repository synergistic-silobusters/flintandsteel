<md-card>
    <img ng-if="ideaHasImage()" ng-src="{{idea.image}}" class="md-card-image">
    <md-card-content>
        <div ng-hide="ideasView.enableEdit">
            <h1>{{idea.title}}</h1>
            <h3>by {{idea.author.name}}</h3>
            <p>{{idea.description}}</p>
        </div>
        <form ng-show="ideasView.enableEdit" name="newIdeaForm">
            <div layout="column">
                <md-input-container>
                    <label>Title</label>
                    <input ng-model="idea.title" required>
                </md-input-container>
                <md-input-container flex>
                    <label>Description</label>
                    <textarea ng-model="idea.description" columns="1" md-maxlength="1000" required></textarea>
                </md-input-container>
                <p></p>
                <div layout="row" layout-align="end center">
                    <md-button class="md-raised md-primary" ng-click="ideasView.editIdea(idea.title, idea.description)">Submit</md-button>
                    <md-button class="md-raised md-primary" ng-click="ideasView.refreshIdea()">Cancel</md-button>
                </div>
            </div>
        </form>
    </md-card-content>
    <md-card-footer>
        <md-fab-speed-dial md-direction="right" class="md-fling" md-open="isOpen" ng-mouseenter="isOpen=true" ng-mouseleave="isOpen=false" ng-show="ideasView.isUserAuthor() && !ideasView.enableEdit">
        <md-fab-trigger class="align-with-text">
            <md-button aria-label="menu" class="md-fab md-primary">
                <i class="material-icons icon-button-adjust">&#xE5D2;</i>
            </md-button>
        </md-fab-trigger>
        <md-fab-actions>
            <div>
                <md-button aria-label="edit" class="md-icon-button" ng-click="ideasView.enableEdit = true;">
                    <md-tooltip md-direction="top">Edit Idea</md-tooltip>
                    <i class="material-icons icon-button-adjust">&#xE254;</i>
                </md-button>
            </div>
            <div>
                <md-button aria-label="delete" class="md-icon-button" ng-click="ideasView.confirmDeleteIdea($event);">
                    <md-tooltip md-direction="top">Delete Idea</md-tooltip>
                    <i class="material-icons icon-button-adjust">&#xE872;</i>
                </md-button>
            </div>
        </md-fab-actions>
        </md-fab-speed-dial>
            <i ng-show="idea.timeModified !== idea.timeCreated && !ideasView.enableEdit">Edited {{momentizeTime(idea.timeModified)}}</i>
    </md-card-footer>
</md-card>
<md-card>
    <md-card-content>
        <span flex ng-if="isUserLoggedIn() && !isUserLiked()">
            <md-button class="md-icon-button" aria-label="Like" ng-click="likeIdea()">
                <i class="material-icons icon-button-adjust">&#xE87E;</i>
            </md-button>
        </span>
        <span flex ng-if="isUserLoggedIn() && isUserLiked()">
            <md-button class="md-icon-button" aria-label="Unlike" ng-click="unlikeIdea()">
                <i class="material-icons icon-button-adjust">&#xE87D;</i>
            </md-button>
        </span>
        <span flex>{{idea.likes.length}} <a class="idea-likes-click" ng-click="openLikes($event, idea.likes)">likes</a> and {{idea.backs.length}} backs</span>
    </md-card-content>
</md-card>
<md-card>
    <md-card-content>
        <md-tabs md-dynamic-height md-border-bottom="">
            <md-tab label="Comments">
                <md-content class="md-padding">
                    <md-list>
                        <md-list-item class="md-2-line" ng-repeat="comment in idea.comments" ng-mouseover="hovered = true" ng-mouseout="hovered = false">
                            <div ng-show="hovered === true && ideasView.isUserAuthorOfComment($index) && comment.deleted !== true">
                                <md-button class="md-icon-button" aria-label="Delete Comment" ng-click="ideasView.deleteComment($index)">
                                    <i class="material-icons icon-button-adjust">&#xE14C;</i>
                                </md-button>
                            </div>
                            <div class="md-list-item-text" ng-class="{'deleted': comment.deleted === true}">
                                <h3>{{comment.text}}</h3>
                                <p>{{comment.author.name}} <small class="extra-space-left" ng-bind="momentizeTime(comment.time)"></small></p>
                            </div>
                        </md-list-item>
                    </md-list>
                    <div layout="row" ng-if="isUserLoggedIn()">
                        <md-input-container id="comment-box-container" class="no-padding-bottom" flex>
                            <label>Add a comment</label>
                            <input id="comment-box" ng-model="ideasView.newComment" type="text" />
                        </md-input-container>
                        <md-button class="md-icon-button" aria-label="Submit" ng-disabled="ideasView.newComment === ''" ng-click="addNewInteraction('comments')">
                            <i class="material-icons icon-button-adjust">&#xE876;</i>
                        </md-button>
                    </div>
                </md-content>
            </md-tab>
            <md-tab label="Backers">
                <md-content class="md-padding">
                    <md-list>
                        <md-list-item class="md-3-line" ng-repeat="back in idea.backs">
                            <div class="md-list-item-text">
                                <h3>{{back.text}}
                                    <span class="extra-padding-left-sm">
                                        <small ng-bind="momentizeTime(back.time)"></small>
                                    </span>
                                </h3>
                                <p>
                                    {{back.author.name}}
                                </p>
                                <span class="custom-chip-wrapper" ng-repeat="type in back.types">
                                    <small  class="custom-chip {{type._lowername}}" >{{type.name}}</small>
                                </span>
                            </div>
                        </md-list-item>
                    </md-list>
                    <div layout="row" ng-if="isUserLoggedIn() && !hasUserBacked()">
                        <div layout="column" flex>
                            <md-input-container id="back-box-container" class="no-padding-bottom">
                                <label>Back this idea...</label>
                                <input id="back-box" ng-model="ideasView.newBack" type="text" />
                            </md-input-container>
                            <md-chips ng-model="selectedTypes" md-autocomplete-snap md-require-match="true" ng-show="ideasView.newBack">
                                <md-autocomplete
                                    md-selected-item="selectedType"
                                    md-selected-item-change=""
                                    md-search-text="searchText"
                                    md-search-text-change=""
                                    md-min-length="0"
                                    md-items="type in querySearch(searchText)"
                                    md-item-text="type.name"
                                    placeholder="Type of backing">
                                    <span md-highlight-text="ctrl.searchText">{{type.name}}</span>
                                </md-autocomplete>
                                <md-chip-template>
                                    <span>
                                        <small >{{$chip.name}}</small>
                                    </span>
                                </md-chip-template>
                            </md-chips>
                        </div>
                        <div layout="column" layout-align="center end">
                            <md-button class="md-icon-button" aria-label="Submit" ng-disabled="ideasView.newBack === ''" ng-click="addNewInteraction('backs')">
                                <i class="material-icons icon-button-adjust">&#xE876;</i>
                            </md-button>
                        </div>
                    </div>
                </md-content>
            </md-tab>
            <md-tab label="Team">
                <md-content class="md-padding">
                    <div layout="row">
                        <div layout="column">
                            <!-- IN TEAM EDIT MODE - Currently limited to the Author -->
                            <md-list ng-show="ideasView.isUserAuthor() && ideasView.enableTeamEdit === true">
                                <md-list-item class="md-1-line" ng-show="idea.team.length === 0">
                                    <p>There are no members selected for the team. Add backers to your team below.</p>
                                </md-list-item>
                                <md-list-item class="md-1-line" ng-show="idea.team.length === 1 && ideasView.isUserMemberOfTeam()">
                                    <p>You are the only member of your team. Once people back your idea you will be able to add them to your team.</p>
                                </md-list-item>
                                <md-list-item class="md-1-line" ng-show="idea.team.length === 1 && !ideasView.isUserMemberOfTeam()">
                                    <p>There is only one member on the team and it is not you!  You can add yourself back to the team by selecting edit.</p>
                                </md-list-item>
                                <md-list-item class="md-1-line" ng-show="idea.team.length > 1">
                                    <p>Select the backers that you would like to be a part of your team.</p>
                                </md-list-item>
                                <md-list-item class="md-1-line" ng-repeat="back in idea.backs">
                                    <div class="md-list-item-text">
                                        <p>
                                            <md-switch ng-model="back.isInTeam" class="md-warn"> <!-- Be careful when editing backs because of this -->
                                                {{back.author.name}}
                                            </md-switch>
                                        </p>
                                        <span class="custom-chip-wrapper" ng-repeat="type in back.types">
                                            <small class="custom-chip {{type._lowername}}">{{type.name}}</small>
                                        </span>
                                    </div>
                                </md-list-item>
                            </md-list>
                        </div>
                        <div layout="column">
                            <!-- NOT IN TEAM EDIT MODE -->
                            <md-list ng-show="ideasView.enableTeamEdit === false">
                                <md-list-item class="md-1-line" ng-show="idea.team.length === 0">
                                    <p>There are no members currently on the team.</p>
                                </md-list-item>
                                <md-list-item class="md-1-line" ng-show="ideasView.isUserAuthor() && idea.team.length === 1 && ideasView.isUserMemberOfTeam()">
                                    <p>You are the only member of your team. Once people back your idea you will be able to add them to your team.</p>
                                </md-list-item>
                                <md-list-item class="md-1-line" ng-show="ideasView.isUserAuthor() && idea.team.length === 1 && !ideasView.isUserMemberOfTeam()">
                                    <p>There is only one member on the team and it is not you!  You can add yourself back to the team by selecting edit.</p>
                                </md-list-item>
                                <md-list-item class="md-1-line" ng-show="ideasView.isUserAuthor() && idea.team.length > 1">
                                    <p>Your current team is shown below. You can edit who makes up your team at any time.</p>
                                </md-list-item>
                                <md-list-item class="md-1-line" ng-show="!ideasView.isUserAuthor() && !ideasView.isUserMemberOfTeam() && isUserLoggedIn() && idea.team.length > 0">
                                    <p>You are currently not part of the team.  If you would like to become part of the team, please back the idea so the author can be notified about your interest in being involved.</p>
                                </md-list-item>
                                <md-list-item class="md-1-line" ng-show="!ideasView.isUserAuthor() && ideasView.isUserMemberOfTeam() && isUserLoggedIn()">
                                    <p>You are part of the team!</p>
                                </md-list-item>
                                <md-list-item class="md-3-line" ng-repeat="back in idea.backs" ng-show="back.isInTeam">
                                    <div class="md-list-item-text">
                                        <p>
                                            {{back.author.name}}
                                        </p>
                                        <span class="custom-chip-wrapper" ng-repeat="type in back.types">
                                            <small class="custom-chip {{type._lowername}}">{{type.name}}</small>
                                        </span>
                                    </div>
                                </md-list-item>
                            </md-list>
                        </div>
                    </div>
                    <div ng-show="ideasView.isUserAuthor()">
                        <md-button ng-show="ideasView.enableTeamEdit === false" class="md-raised md-primary" ng-click="ideasView.enableTeamEdit = true">
                            <md-tooltip md-direction="top">Edit Team Members</md-tooltip>
                            Edit
                        </md-button>
                        <md-button ng-show="ideasView.enableTeamEdit === true" class="md-raised md-primary" ng-click="ideasView.updateTeam()">
                            <md-tooltip md-direction="top">Submit Team Members</md-tooltip>
                            Submit
                        </md-button>
                        <md-button ng-show="ideasView.enableTeamEdit === true" class="md-raised md-primary" ng-click="ideasView.refreshTeam()">
                            <md-tooltip md-direction="top">Cancel Team Member Edit</md-tooltip>
                            Cancel
                        </md-button>
                    </div>
                </md-content>
            </md-tab>
        </md-tabs>
    </md-card-content>
</md-card>
